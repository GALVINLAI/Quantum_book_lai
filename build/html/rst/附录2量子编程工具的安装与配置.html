<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2.1 QPanda &mdash; 量子计算与编程入门 1.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3.1 ChemiQ化学软件的安装" href="%E9%99%84%E5%BD%953%E9%87%8F%E5%AD%90%E5%8C%96%E5%AD%A6%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8.html" />
    <link rel="prev" title="1.6 矩阵的函数" href="%E9%99%84%E5%BD%951%E9%87%8F%E5%AD%90%E8%AE%A1%E7%AE%97%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%805.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> 量子计算与编程入门
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">第一章 背景知识</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="1.1%E4%B8%89%E9%97%AE%E9%87%8F%E5%AD%90%E8%AE%A1%E7%AE%97.html">1.1 三问量子计算</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.2%E9%87%8F%E5%AD%90%E8%AE%A1%E7%AE%97%E7%9A%84%E5%8F%91%E5%B1%95%E5%8E%86%E5%8F%B2.html">1.2 量子计算的发展历史</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.3%E9%87%8F%E5%AD%90%E8%AE%A1%E7%AE%97%E8%BD%AF%E4%BB%B6%E4%BB%8B%E7%BB%8D.html">1.3 量子计算软件介绍</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">第二章 量子计算基础</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="2.1%E9%87%8F%E5%AD%90%E5%8A%9B%E5%AD%A6%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80.html">2.1 量子力学基础理论</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.2%E9%87%8F%E5%AD%90%E7%A8%8B%E5%BA%8F.html">2.2 量子程序</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">第三章 量子计算硬件基础</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="3.1%E9%87%8F%E5%AD%90%E8%8A%AF%E7%89%87.html">3.1 量子芯片</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.2%E9%87%8F%E5%AD%90%E8%AE%A1%E7%AE%97%E7%A1%AC%E4%BB%B6.html">3.2 量子计算机硬件</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.3%E9%87%8F%E5%AD%90%E8%AE%A1%E7%AE%97%E6%9C%BA.html">3.3 量子计算机</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">第四章 量子算法与编程</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="4.1%E9%87%8F%E5%AD%90%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83.html">4.1 量子软件开发环境</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.2%E9%87%8F%E5%AD%90%E7%AE%97%E6%B3%95%E7%AE%80%E4%BB%8B.html">4.2 量子算法简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.3Deutsch-Josza%E7%AE%97%E6%B3%95.html">4.3 Deutsch-Josza算法</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.4Grover%E7%AE%97%E6%B3%95.html">4.4 Grover算法</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.5QAOA%E7%AE%97%E6%B3%95.html">4.5 QAOA算法</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.6VQE%E7%AE%97%E6%B3%95.html">4.6 VQE算法</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.7Shor%E5%88%86%E8%A7%A3%E7%AE%97%E6%B3%95.html">4.7 Shor分解算法</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">第五章 量子计算前言话题</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="5.1%E5%88%A9%E7%94%A8QPanda%E6%B5%8B%E8%AF%95%E9%87%8F%E5%AD%90%E7%B3%BB%E7%BB%9F%E5%99%AA%E5%A3%B0.html">5.1 利用QPanda测试量子系统噪声</a></li>
<li class="toctree-l1"><a class="reference internal" href="5.2%E9%87%8F%E5%AD%90%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0.html">5.2 量子机器学习</a></li>
<li class="toctree-l1"><a class="reference internal" href="5.3%E4%BD%BF%E7%94%A8%E5%8D%95%E6%8C%AF%E5%B9%85%E5%92%8C%E9%83%A8%E5%88%86%E6%8C%AF%E5%B9%85%E9%87%8F%E5%AD%90%E8%99%9A%E6%8B%9F%E6%9C%BA.html">5.3 使用单振幅和部分振幅量子虚拟机</a></li>
<li class="toctree-l1"><a class="reference internal" href="5.4%E5%B0%86%E9%87%8F%E5%AD%90%E7%A8%8B%E5%BA%8F%E7%BC%96%E8%AF%91%E5%88%B0%E4%B8%8D%E5%90%8C%E7%9A%84%E9%87%8F%E5%AD%90%E8%8A%AF%E7%89%87%E4%B8%8A.html">5.4 将量子程序编译到不同的量子芯片上</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">附录一 量子计算数学基础</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="%E9%99%84%E5%BD%951%E9%87%8F%E5%AD%90%E8%AE%A1%E7%AE%97%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%801.html">1.1 概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E9%99%84%E5%BD%951%E9%87%8F%E5%AD%90%E8%AE%A1%E7%AE%97%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%801.html#id2">1.2 集合与映射</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E9%99%84%E5%BD%951%E9%87%8F%E5%AD%90%E8%AE%A1%E7%AE%97%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%802.html">1.3 向量空间</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E9%99%84%E5%BD%951%E9%87%8F%E5%AD%90%E8%AE%A1%E7%AE%97%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%803.html">1.4 矩阵与矩阵的运算</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E9%99%84%E5%BD%951%E9%87%8F%E5%AD%90%E8%AE%A1%E7%AE%97%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%804.html">1.5 矩阵的特征及矩阵</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E9%99%84%E5%BD%951%E9%87%8F%E5%AD%90%E8%AE%A1%E7%AE%97%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%805.html">1.6 矩阵的函数</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E9%99%84%E5%BD%951%E9%87%8F%E5%AD%90%E8%AE%A1%E7%AE%97%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%805.html#id2">1.7 线性算子与矩阵表示</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">附录二 量子编程工具安装与配置</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">2.1 QPanda</a></li>
<li class="toctree-l1"><a class="reference internal" href="#pyqpanda">2.2 pyQPanda</a></li>
<li class="toctree-l1"><a class="reference internal" href="#vqnet">2.3 VQNet</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#vqnet-python">2.3.1 VQNet python包安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">2.3.2  VQNet 的一个简单例子</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#qurator">2.4 Qurator</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">2.4.1 设计思想</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">2.4.2 准备工作</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">2.4.3 快速入门</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">2.4.4 功能介绍</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">附录三 量子化学工具的安装与使用</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="%E9%99%84%E5%BD%953%E9%87%8F%E5%AD%90%E5%8C%96%E5%AD%A6%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8.html">3.1 ChemiQ化学软件的安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E9%99%84%E5%BD%953%E9%87%8F%E5%AD%90%E5%8C%96%E5%AD%A6%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8.html#id1">3.2 ChemiQ软件应用示例</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E9%99%84%E5%BD%953%E9%87%8F%E5%AD%90%E5%8C%96%E5%AD%A6%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8.html#id2">3.3  ChemiQ接口介绍与使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E9%99%84%E5%BD%953%E9%87%8F%E5%AD%90%E5%8C%96%E5%AD%A6%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8.html#vqe">3.4 非梯度下降法实现VQE算法代码示例</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">量子计算与编程入门</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>2.1 QPanda</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/rst/附录2量子编程工具的安装与配置.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="qpanda">
<h1>2.1 QPanda<a class="headerlink" href="#qpanda" title="Permalink to this heading">¶</a></h1>
<p>​  一种功能齐全，运行高效的量子软件开发工具包</p>
<p>​  QPanda 2是由本源量子开发的开源量子计算框架，它可以用于构建、运行和优化量子算法。QPanda 2作为本源量子计算系列软件的基础库，为QRunes、Qurator、量子计算服务提供核心部件。</p>
<p><strong>编译环境</strong></p>
<p>​  QPanda 2是以C++为宿主语言，其对系统的环境要求如表附2.1.1：</p>
<p class="centered">
<strong>表附2.1.1 环境要求</strong></p><table class="docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>software</strong></p></td>
<td><p><strong>version</strong></p></td>
</tr>
<tr class="row-even"><td><p>CMake</p></td>
<td><p>&gt;= 3.1</p></td>
</tr>
<tr class="row-odd"><td><p>GCC</p></td>
<td><p>&gt;= 5.0</p></td>
</tr>
<tr class="row-even"><td><p>Python</p></td>
<td><p>&gt;= 3.7.0</p></td>
</tr>
</tbody>
</table>
<p><strong>下载QPanda 2</strong></p>
<p>​  如果在您的系统上已经安装了git， 你可以直接输入以下命令来获取QPanda2：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/OriginQ/QPanda 2.git
</pre></div>
</div>
<p>​  对于一些为安装git的伙伴来说，也可以直接通过浏览器去下载QPanda 2， 具体的操作步骤如下：</p>
<p>​  1.在浏览器中输入 <a class="reference external" href="https://github.com/OriginQ/QPanda">https://github.com/OriginQ/QPanda</a> 2 ，进入网页会看到：</p>
<img alt="../_images/图附2.1.1.jpg" class="align-center" src="../_images/图附2.1.1.jpg" />
<p class="centered">
<strong>图附2.1.1 Github界面</strong></p><p>​  2.点击 Clone or download 看到界面：</p>
<img alt="../_images/wps1252.jpg" class="align-center" src="../_images/wps1252.jpg" />
<p class="centered">
<strong>图附2.1.2 Github界面</strong></p><p>​  3.然后点击 Download ZIP， 就会完成QPanda2的下载。</p>
<img alt="../_images/wps1253.jpg" class="align-center" src="../_images/wps1253.jpg" />
<p class="centered">
<strong>图附2.1.3 下载</strong></p><p><strong>编译</strong></p>
<p>​  我们支持在Windows、Linux、MacOS下构建QPanda 2。用户可以通过CMake的方式来构建QPanda 2。</p>
<p>Windows</p>
<p>​  在Windows构建QPanda 2。用户首先需要保证在当前主机下安装了CMake环境和C++编译环境，用户可以通过Visual Studio和MinGW方式编译QPanda 2。</p>
<p>  1. 使用Visual Studio</p>
<p>​  这里以Visual Studio 2017为例，使用Visual Studio 2017 编译QPanda 2,只需要安装Visual Studio 2017，并需要在组件中安装CMake组件。安装完成之后，用Visual Studio 2017打开QPanda 2文件夹，即可使用CMake编译QPanda 2。</p>
<img alt="../_images/wps1254.jpg" class="align-center" src="../_images/wps1254.jpg" />
<p class="centered">
<strong>图附2.1.4 使用CMake编译QPanda2</strong></p><p>  2. 使用MinGW</p>
<p>​  使用MinGW编译QPanda 2，需要自行搭建CMake和MinGW环境，用户可自行在网上查询环境搭建教程。（注意： MinGW需要安装64位版本）</p>
<p>​  CMake+MinGW的编译命令如下：</p>
<p>    1. 在QPanda 2根目录下创建build文件夹</p>
<p>    2. 进入build文件夹，打开cmd</p>
<p>    3. 由于MinGW对CUDA的支持存在一些问题，所以在编译时需要禁掉CUDA，输入以下命令：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span><span class="n">cmake</span> <span class="o">-</span><span class="n">G</span><span class="s2">&quot;MinGW Makefiles&quot;</span> <span class="o">-</span><span class="n">DFIND_CUDA</span><span class="o">=</span><span class="n">OFF</span> <span class="o">-</span><span class="n">DCMAKE_INSTALL_PREFIX</span><span class="o">=</span><span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">QPanda2</span> <span class="o">..</span>
<span class="mf">2.</span><span class="n">mingw32</span><span class="o">-</span><span class="n">make</span>
</pre></div>
</div>
<p>Linux 和MacOS</p>
<p>​  在Linux和MacOS下编译QPanda 2，命令是一样的。</p>
<p>​  编译步骤如下：</p>
<p>    1. 进入QPanda 2根目录</p>
<p>    2. 输入以下命令：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="n">build</span>
<span class="mf">2.</span><span class="n">cd</span> <span class="n">build</span>
<span class="mf">3.</span><span class="n">cmake</span> <span class="o">..</span>
<span class="mf">4.</span><span class="n">make</span>
</pre></div>
</div>
<p>​  如果有需求，用户通过命令修改QPanda 2的安装路径，配置方法如下所示：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="n">build</span>
<span class="mf">2.</span><span class="n">cd</span> <span class="n">build</span>
<span class="mf">3.</span><span class="n">cmake</span> <span class="o">-</span><span class="n">DCMAKE_INSTALL_PREFIX</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span> <span class="o">..</span>
<span class="mf">4.</span><span class="n">make</span>
</pre></div>
</div>
<p><strong>安装</strong></p>
<p>​  QPanda 2编译完成后，会以库的形式存在。为了方便调用，大家可以把QPanda 2库安装到指定位置，安装的方式如下所示。</p>
<p>Windows</p>
<p>  1. 使用Visual Studio</p>
<p>​  同样以Visual Studio 2017为例,在QPanda 2编译完成后，用户可以安装，Visual Studio 2017的安装方式很简单，只需要在Cmake菜单中选择安装即可。</p>
<img alt="../_images/wps1255.jpg" class="align-center" src="../_images/wps1255.jpg" />
<p class="centered">
<strong>图附2.1.5 在Cmake菜单中选择“安装”</strong></p><p>​  QPanda 2会安装在用户在CMakeSettings.json中配置的安装目录下。安装成功后会在用户配置的的目录下生成install文件夹，里面安装生成include和lib文件。如果有需求，用户可以在Visual Studio的CMakeSettings.json配置文件修改的安装路径。生成CMakeSettings.json的方法如下图所示：</p>
<img alt="../_images/wps1256.jpg" class="align-center" src="../_images/wps1256.jpg" />
<p class="centered">
<strong>图附2.1.6 生成CMakeSettings.json的方法</strong></p><p>​  修改QPanda 2的安装路径如下图所示：</p>
<img alt="../_images/wps1257.jpg" class="align-center" src="../_images/wps1257.jpg" />
<p class="centered">
<strong>图附2.1.7 修改QPanda 2的安装路径</strong></p><p>​  参数修改完成后，cmake选项下执行安装，QPanda 2的lib库文件和include头文件会安装到用户指定的安装位置。(注意：需先进行编译成功后才能进行安装)</p>
<p>  2. 使用MinGW</p>
<p>​  在QPanda 2编译完成后，用户可以安装QPanda 2，安装命令如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span><span class="n">mingw32</span><span class="o">-</span><span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
<p>Linux 和MacOS</p>
<p>​  在Linux和MacOS下安装命令QPanda 2，命令是一样的，安装命令如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span><span class="n">sudo</span> <span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
<p><strong>使用</strong></p>
<p>​  不同的平台和不同的IDE在构建C++项目是的方法是不一样的，调用库的方式也不尽相同，大家可以选择用自己的方式调用QPanda 2库, 下面我们以cmake构建项目为例，演示调用QPanda 2库进行量子编程。</p>
<p>​  Visual Studio调用QPanda 2库</p>
<p>​  Visual Studio下调用QPanda 2库的CMakeList的写法为</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1.cmake_minimum_required(VERSION 3.1)
2.project(testQPanda)
3.SET(CMAKE_INSTALL_PREFIX  &quot;C:/QPanda2&quot;) # QPanda2安装的路径
4.SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} &quot;${CMAKE_INSTALL_PREFIX}/lib/cmake&quot;)
5.
6.set(CMAKE_CXX_STANDARD 14)
7.set(CMAKE_CXX_STANDARD_REQUIRED ON)
8.if (NOT USE_MSVC_RUNTIME_LIBRARY_DLL)
9.    foreach (flag
10.        CMAKE_C_FLAGS
11.        CMAKE_C_FLAGS_DEBUG
12.        CMAKE_C_FLAGS_RELEASE
13.        CMAKE_C_FLAGS_MINSIZEREL
14.        CMAKE_C_FLAGS_RELWITHDEBINFO
15.        CMAKE_CXX_FLAGS
16.        CMAKE_CXX_FLAGS_DEBUG
17.        CMAKE_CXX_FLAGS_RELEASE
18.        CMAKE_CXX_FLAGS_MINSIZEREL
19.        CMAKE_CXX_FLAGS_RELWITHDEBINFO)
20.
21.        if (${flag} MATCHES &quot;/MD&quot;)
22.            string(REGEX REPLACE &quot;/MD&quot; &quot;/MT&quot; ${flag} &quot;${${flag}}&quot;)
23.        endif()
24.        if (${flag} MATCHES &quot;/MDd&quot;)
25.            string(REGEX REPLACE &quot;/MDd&quot; &quot;/MTd&quot; ${flag} &quot;${${flag}}&quot;)
26.        endif()
27.        if (${flag} MATCHES &quot;/W3&quot;)
28.            string(REGEX REPLACE &quot;/W3&quot; &quot;/W0&quot; ${flag} &quot;${${flag}}&quot;)
29.        endif()
30.    endforeach()
31.endif()
32.
33.set(LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}/lib)
34.set(EXECUTABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR}/bin)
35.
36.find_package(OpenMP)
37.if(OPENMP_FOUND)
38.    option(USE_OPENMP &quot;find OpenMP&quot; ON)
39.    message(&quot;OPENMP FOUND&quot;)
40.    set(CMAKE_C_FLAGS &quot;${CMAKE_C_FLAGS} ${OpenMP_C_FLAGS}&quot;)
41.    set(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} ${OpenMP_CXX_FLAGS}&quot;)
42.    set(CMAKE_EXE_LINKER_FLAGS &quot;${CMAKE_EXE_LINKER_FLAGS} ${OpenMP_EXE_LINKER_FLAGS}&quot;)
43.else(OPENMP_FOUND)
44.    option(USE_OPENMP &quot;not find OpenMP&quot; OFF)
45.endif(OPENMP_FOUND)
46.
47.find_package(QPANDA REQUIRED)
48.if (QPANDA_FOUND)
49.    include_directories(${QPANDA_INCLUDE_DIR})
50.endif (QPANDA_FOUND)
51.
52.add_executable(${PROJECT_NAME} test.cpp)
53.target_link_libraries(${PROJECT_NAME} ${QPANDA_LIBRARIES})
</pre></div>
</div>
<p>​MinGW调用QPanda 2库</p>
<p>​  MinGW调用QPanda 2库的CMakeList的写法为</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1.cmake_minimum_required(VERSION 3.1)
2.project(testQPanda)
3.SET(CMAKE_INSTALL_PREFIX  &quot;C:/QPanda2&quot;) # QPanda2安装的路径
4.SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} &quot;${CMAKE_INSTALL_PREFIX}/lib/cmake&quot;)
5.
6.
7.add_definitions(&quot;-w -DGTEST_USE_OWN_TR1_TUPLE=1&quot;)
8.set(CMAKE_BUILD_TYPE &quot;Release&quot;)
9.set(CMAKE_CXX_FLAGS_DEBUG &quot;$ENV{CXXFLAGS} -O0 -g -ggdb&quot;)
10.set(CMAKE_CXX_FLAGS_RELEASE &quot;$ENV{CXXFLAGS} -O3&quot;)
11.add_compile_options(-fpermissive)
12.
13.set(LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}/lib)
14.set(EXECUTABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR}/bin)
15.
16.find_package(OpenMP)
17.if(OPENMP_FOUND)
18.    option(USE_OPENMP &quot;find OpenMP&quot; ON)
19.    message(&quot;OPENMP FOUND&quot;)
20.    set(CMAKE_C_FLAGS &quot;${CMAKE_C_FLAGS} ${OpenMP_C_FLAGS}&quot;)
21.    set(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} ${OpenMP_CXX_FLAGS}&quot;)
22.    set(CMAKE_EXE_LINKER_FLAGS &quot;${CMAKE_EXE_LINKER_FLAGS} ${OpenMP_EXE_LINKER_FLAGS}&quot;)
23.else(OPENMP_FOUND)
24.    option(USE_OPENMP &quot;not find OpenMP&quot; OFF)
25.endif(OPENMP_FOUND)
26.
27.find_package(QPANDA REQUIRED)
28.if (QPANDA_FOUND)
29.    include_directories(${QPANDA_INCLUDE_DIR})
30.endif (QPANDA_FOUND)
31.
32.add_executable(${PROJECT_NAME} test.cpp)
33.target_link_libraries(${PROJECT_NAME} ${QPANDA_LIBRARIES})
</pre></div>
</div>
<p>linux、MacOS下使用QPanda2</p>
<p>​  linux、MacOS使用QPanda2的方式是相同的，其CmakeList.txt的写法为：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1.cmake_minimum_required(VERSION 3.1)
2.project(testQPanda)
3.SET(CMAKE_INSTALL_PREFIX  &quot;/usr/local&quot;) # QPanda2安装的路径
4.SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} &quot;${CMAKE_INSTALL_PREFIX}/lib/cmake&quot;)
5.
6.
7.add_definitions(&quot;-w -DGTEST_USE_OWN_TR1_TUPLE=1&quot;)
8.set(CMAKE_BUILD_TYPE &quot;Release&quot;)
9.set(CMAKE_CXX_FLAGS_DEBUG &quot;$ENV{CXXFLAGS} -O0 -g -ggdb&quot;)
10.set(CMAKE_CXX_FLAGS_RELEASE &quot;$ENV{CXXFLAGS} -O3&quot;)
11.add_compile_options(-fpermissive)
12.
13.set(LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}/lib)
14.set(EXECUTABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR}/bin)
15.
16.find_package(OpenMP)
17.if(OPENMP_FOUND)
18.    option(USE_OPENMP &quot;find OpenMP&quot; ON)
19.    message(&quot;OPENMP FOUND&quot;)
20.    set(CMAKE_C_FLAGS &quot;${CMAKE_C_FLAGS} ${OpenMP_C_FLAGS}&quot;)
21.    set(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} ${OpenMP_CXX_FLAGS}&quot;)
22.    set(CMAKE_EXE_LINKER_FLAGS &quot;${CMAKE_EXE_LINKER_FLAGS} ${OpenMP_EXE_LINKER_FLAGS}&quot;)
23.else(OPENMP_FOUND)
24.    option(USE_OPENMP &quot;not find OpenMP&quot; OFF)
25.endif(OPENMP_FOUND)
26.
27.find_package(QPANDA REQUIRED)
28.if (QPANDA_FOUND)
29.    include_directories(${QPANDA_INCLUDE_DIR})
30.endif (QPANDA_FOUND)
31.
32.add_executable(${PROJECT_NAME} test.cpp)
33.target_link_libraries(${PROJECT_NAME} ${QPANDA_LIBRARIES})
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>test.cpp 为使用QPanda2的一个示例。有兴趣的可以试着将其合并在一起形成一个跨平台的CMakeList.txt。</p>
</div>
<p>​  通过一个示例介绍QPanda 2的使用，下面的例子可以在量子计算机中构建量子纠缠态 <span class="math notranslate nohighlight">\((|00\rangle +|11\rangle)\)</span> ，对其进行测量，重复制备1000次。 预期的结果是约有50%的概率使测量结果分别在00或11上。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span><span class="c1">#include &quot;QPanda.h&quot;</span>
<span class="mf">2.</span><span class="n">using</span> <span class="n">namespace</span> <span class="n">QPanda</span><span class="p">;</span>
<span class="mf">3.</span><span class="n">int</span> <span class="n">main</span><span class="p">()</span>
<span class="mf">4.</span><span class="p">{</span>
<span class="mf">5.</span>    <span class="n">auto</span> <span class="n">qvm</span> <span class="o">=</span> <span class="n">CPUQVM</span><span class="p">();</span>
<span class="mf">6.</span>    <span class="n">auto</span> <span class="n">prog</span> <span class="o">=</span> <span class="n">QProg</span><span class="p">();</span>
<span class="mf">7.</span>    <span class="n">auto</span> <span class="n">q</span> <span class="o">=</span> <span class="n">qvm</span><span class="o">.</span><span class="n">qAllocMany</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="mf">8.</span>    <span class="n">auto</span> <span class="n">c</span> <span class="o">=</span> <span class="n">qvm</span><span class="o">.</span><span class="n">cAllocMany</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="mf">9.</span>    <span class="n">prog</span> <span class="o">&lt;&lt;</span> <span class="n">H</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="mf">10.</span>        <span class="o">&lt;&lt;</span> <span class="n">CNOT</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="mf">11.</span>        <span class="o">&lt;&lt;</span> <span class="n">MeasureAll</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
<span class="mf">12.</span>    <span class="n">auto</span> <span class="n">results</span> <span class="o">=</span> <span class="n">qvm</span><span class="o">.</span><span class="n">runWithConfiguration</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
<span class="mf">13.</span>    <span class="k">for</span> <span class="p">(</span><span class="n">auto</span> <span class="n">result</span> <span class="p">:</span> <span class="n">results</span><span class="p">){</span>
<span class="mf">14.</span>        <span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">result</span><span class="o">.</span><span class="n">first</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot; : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">result</span><span class="o">.</span><span class="n">second</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="n">endl</span><span class="p">;</span>
<span class="mf">15.</span>    <span class="p">}</span>
<span class="mf">16.</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="mf">17.</span><span class="p">}</span>
</pre></div>
</div>
<p>​  编译方式与编译QPanda库的方式基本类似，在这里就不多做赘述。</p>
<p>​  编译之后的可执行文件会生成在build下的bin文件夹中，进入到bin目录下就可以执行自己编写的量子程序了。</p>
<p>​  计算结果如下所示：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.00</span> <span class="p">:</span> <span class="mi">493</span>
<span class="mf">2.11</span> <span class="p">:</span> <span class="mi">507</span>
</pre></div>
</div>
</section>
<section id="pyqpanda">
<h1>2.2 pyQPanda<a class="headerlink" href="#pyqpanda" title="Permalink to this heading">¶</a></h1>
<p>系统配置和安装</p>
<p>​  我们通过pybind11工具，以一种直接和简明的方式，对QPanda2中的函数、类进行封装，并且提供了几乎完美的映射功能。 封装部分的代码在QPanda2编译时会生成为动态库，从而可以作为Python的包引入。</p>
<p>系统配置</p>
<p>​  pyqpanda是以C++为宿主语言，其对系统的环境要求如表附2.2.1：</p>
<p class="centered">
<strong>表附2.2.1 环境要求</strong></p><table class="docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>software</strong></p></td>
<td><p><strong>version</strong></p></td>
</tr>
<tr class="row-even"><td><p>GCC</p></td>
<td><p>&gt;= 5.4.0</p></td>
</tr>
<tr class="row-odd"><td><p>Python</p></td>
<td><p>&gt;= 3.7.0</p></td>
</tr>
</tbody>
</table>
<p>下载pyqpanda</p>
<p>​  如果你已经安装好了Python环境和pip工具， 在终端或者控制台输入下面命令：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pyqpanda</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>在linux下若遇到权限问题需要加 sudo</p>
</div>
</section>
<section id="vqnet">
<h1>2.3 VQNet<a class="headerlink" href="#vqnet" title="Permalink to this heading">¶</a></h1>
<section id="vqnet-python">
<h2>2.3.1 VQNet python包安装<a class="headerlink" href="#vqnet-python" title="Permalink to this heading">¶</a></h2>
<p>​  我们提供了Linux,Windows,MacOS上的python预编译包供安装，需要python==3.8。还需要numpy&gt;=1.18.5,pyqpanda&gt;=3.7.8。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pyvqnet</span>
</pre></div>
</div>
<p><strong>VQNet 测试安装成功</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyvqnet</span>
<span class="kn">from</span> <span class="nn">pyvqnet.tensor</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id1">
<h2>2.3.2  VQNet 的一个简单例子<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h2>
<p>​  这里使用VQNet的经典神经网络模块以及量子模块完成一个机器学习模型的整体流程的例子介绍。该例子参考 [Data re-uploading for a universal quantum classifier](<a class="reference external" href="https://arxiv.org/abs/1907.02085">https://arxiv.org/abs/1907.02085</a>) 。 量子机器学习中的量子计算模块一般有如下几个部分：</p>
<p>​  （1）编码线路（Encoder），用于将经典数据编码到量子数据； （2）可变参数的量子线路（Ansatz），用于训练带参量子门中的参数； （3）测量模块(Measurement)，用于检测测量值（也就是某个量子比特的量子态在某些轴上的投影）。</p>
<p>​  量子计算模块与经典神经网络的运算模块一样是可微分的，是量子经典神经网络混合模型的理论基础。 VQNet支持将量子计算模块与经典计算模块（例如：卷积，池化，全连接层，激活函数等）一起构成混合机器学习模型，提供多种优化算法优化参数。</p>
<a class="reference internal image-reference" href="../_images/vqnet.png"><img alt="../_images/vqnet.png" class="align-center" src="../_images/vqnet.png" style="width: 500px;" /></a>
<p>​  在量子计算模块，VQNet支持使用本源量子高效的量子软件计算包 [pyQPanda](<a class="reference external" href="https://pyqpanda-toturial.readthedocs.io/zh/latest/">https://pyqpanda-toturial.readthedocs.io/zh/latest/</a>) 进行量子模块构建。 使用pyQPanda提供的各种常用 [量子逻辑门函数接口](<a class="reference external" href="https://pyqpanda-toturial.readthedocs.io/zh/latest/QGate.html">https://pyqpanda-toturial.readthedocs.io/zh/latest/QGate.html</a>) ， [量子线路接口](<a class="reference external" href="https://pyqpanda-toturial.readthedocs.io/zh/latest/QCircuit.html">https://pyqpanda-toturial.readthedocs.io/zh/latest/QCircuit.html</a>) , [量子虚拟机函数接口](<a class="reference external" href="https://pyqpanda-toturial.readthedocs.io/zh/latest/QuantumMachine.html">https://pyqpanda-toturial.readthedocs.io/zh/latest/QuantumMachine.html</a>) ， [测量函数接口](<a class="reference external" href="https://pyqpanda-toturial.readthedocs.io/zh/latest/Measure.html">https://pyqpanda-toturial.readthedocs.io/zh/latest/Measure.html</a>)，用户可以快速构建量子计算模块。</p>
<p>​  接下来的例子我们使用pyQPanda构建了一个量子计算模块。通过VQNet，该量子计算模块可以直接嵌入到混合机器学习模型中进行量子线路参数训练。 本例使用1个量子比特，使用了多个带参数的旋转门 RZ，RY，RZ 对输入x进行编码，并使用 prob_run_dict() 函数观测量子比特的概率测量结果作为输出。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">qdrl_circuit</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span><span class="n">weights</span><span class="p">,</span><span class="n">qlist</span><span class="p">,</span><span class="n">clist</span><span class="p">,</span><span class="n">machine</span><span class="p">):</span>

    <span class="n">x1</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="n">param1</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="c1">#使用pyqpanda接口构建量子线路实例</span>
    <span class="n">circult</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">QCircuit</span><span class="p">()</span>
    <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门，参数位x1[0]</span>
    <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RY门，参数位x1[1]</span>
    <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门，参数位x1[2]</span>
    <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门，参数位param1[0]</span>
    <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RY门，参数位param1[1]</span>
    <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门，参数位param1[2]</span>
    <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门，参数位x1[0]</span>
    <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RY门，参数位x1[1]</span>
    <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门，参数位x1[2]</span>
    <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门，参数位param1[3]</span>
    <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
    <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RY门，参数位param1[4]</span>
    <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
    <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门，参数位param1[5]</span>
    <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
    <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门，参数位x1[0]</span>
    <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RY门，参数位x1[1]</span>
    <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门，参数位x1[2]</span>
    <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门，参数位param1[6]</span>
    <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
    <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RY门，参数位param1[7]</span>
    <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
    <span class="c1">#使用pyqpanda接口在第一个量子比特上插入逻辑门RZ门，参数位param1[8]</span>
    <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>
    <span class="c1">#构建量子程序</span>
    <span class="n">prog</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">QProg</span><span class="p">()</span>
    <span class="n">prog</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">circult</span><span class="p">)</span>
    <span class="c1">#获取概率测量值</span>
    <span class="n">prob</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">prob_run_dict</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="n">qlist</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">prob</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">prob</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">prob</span>
</pre></div>
</div>
<p>​  本例子中机器学习的任务是对随机生成的数据根据进行二分类，其中下图是该数据样例，零为圆点，半径为1以内红色的二维点为一类，蓝色的点为另一类。</p>
<a class="reference internal image-reference" href="../_images/图附2.3.1.png"><img alt="../_images/图附2.3.1.png" class="align-center" src="../_images/图附2.3.1.png" style="width: 350px;" /></a>
<p class="centered">
<strong>图附2.3.1 数据样例</strong></p><p>​  训练测试代码流程：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#导入必须的库和函数</span>
<span class="kn">from</span> <span class="nn">pyvqnet.qnn.qdrl.vqnet_model</span> <span class="kn">import</span> <span class="n">qdrl_circuit</span>
<span class="kn">from</span> <span class="nn">pyvqnet.qnn.quantumlayer</span> <span class="kn">import</span> <span class="n">QuantumLayer</span>
<span class="kn">from</span> <span class="nn">pyvqnet.optim</span> <span class="kn">import</span> <span class="n">adam</span>
<span class="kn">from</span> <span class="nn">pyvqnet.nn.loss</span> <span class="kn">import</span> <span class="n">CategoricalCrossEntropy</span>
<span class="kn">from</span> <span class="nn">pyvqnet.tensor</span> <span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pyvqnet.nn.module</span> <span class="kn">import</span> <span class="n">Module</span>
</pre></div>
</div>
<p>​  定义模型Model，其中 __init__ 函数定义内部各个神经网络模块以及量子模块，forward 函数定义前传函数。QuantumLayer 为封装量子计算的抽象类。 您只需将刚才定义的量子计算函数 qdrl_circuit，待训练参数个数 param_num ，运行后端配置 “cpu” , 量子比特数 qbit_num 输入参数，该类就在 VQNet 中自动计算参数梯度。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#待训练参数个数</span>
<span class="n">param_num</span> <span class="o">=</span> <span class="mi">9</span>
<span class="c1">#量子计算模块量子比特数</span>
<span class="n">qbit_num</span>  <span class="o">=</span> <span class="mi">1</span>
<span class="c1">#定义一个继承于Module的机器学习模型类</span>
<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1">#使用QuantumLayer类，可以把带训练参数的量子线路纳入VQNet的自动微分的训练流程中</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pqc</span> <span class="o">=</span> <span class="n">QuantumLayer</span><span class="p">(</span><span class="n">qdrl_circuit</span><span class="p">,</span><span class="n">param_num</span><span class="p">,</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span><span class="n">qbit_num</span><span class="p">)</span>
    <span class="c1">#定义模型前向函数</span>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<p>​  定义一些训练模型需要的函数</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 随机产生待训练数据的函数</span>
<span class="k">def</span> <span class="nf">circle</span><span class="p">(</span><span class="n">samples</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>  <span class="n">rads</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="p">:</span>
    <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">rads</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">data_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_y</span><span class="p">)</span>

<span class="c1"># 数据载入函数</span>
<span class="k">def</span> <span class="nf">get_minibatch_data</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">batch_size</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="p">):</span>
        <span class="n">idxs</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">x_data</span><span class="p">[</span><span class="n">idxs</span><span class="p">],</span> <span class="n">label</span><span class="p">[</span><span class="n">idxs</span><span class="p">]</span>

<span class="c1">#计算准确率的函数</span>
<span class="k">def</span> <span class="nf">get_score</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="n">pred</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">label</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pred</span> <span class="o">==</span> <span class="n">score</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">score</span>
</pre></div>
</div>
<p>​  VQNet遵循机器学习一般的训练测试流程: 迭代进行载入数据，前传计算，损失函数计算，反向计算，更新参数的操作。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#实例化定义的模型</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">()</span>
<span class="c1">#定义一个优化器，这里用的是Adam</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">adam</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span><span class="n">lr</span> <span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="c1">#定义一个损失函数，这里用的交叉熵损失函数</span>
<span class="n">Closs</span> <span class="o">=</span> <span class="n">CategoricalCrossEntropy</span><span class="p">()</span>
</pre></div>
</div>
<p>​  训练模型部分的函数</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">train</span><span class="p">():</span>

    <span class="c1"># 随机产生待训练数据</span>
    <span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">circle</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">x_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">x_train</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))))</span>
    <span class="c1"># 定义每个批次训练的数据个数</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span>
    <span class="c1"># 最大训练迭代次数</span>
    <span class="n">epoch</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start training...........&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epoch</span><span class="p">):</span>
        <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
        <span class="n">accuracy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">get_minibatch_data</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span><span class="n">batch_size</span><span class="p">):</span>
            <span class="c1"># 优化器中缓存梯度清零</span>
            <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
            <span class="c1"># 模型前向计算</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="c1"># 损失函数计算</span>
            <span class="n">losss</span> <span class="o">=</span> <span class="n">Closs</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
            <span class="c1"># 损失反向传播</span>
            <span class="n">losss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
            <span class="c1"># 优化器参数更新</span>
            <span class="n">optimizer</span><span class="o">.</span><span class="n">_step</span><span class="p">()</span>
            <span class="c1"># 计算准确率等指标</span>
            <span class="n">accuracy</span> <span class="o">+=</span> <span class="n">get_score</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="n">label</span><span class="p">)</span>

            <span class="n">loss</span> <span class="o">+=</span> <span class="n">losss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="n">batch_size</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;epoch:</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, train_accuracy:</span><span class="si">{</span><span class="n">accuracy</span><span class="o">/</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;epoch:</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, train_loss:</span><span class="si">{</span><span class="n">loss</span><span class="o">/</span><span class="n">count</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>​  验证模型部分的函数</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test</span><span class="p">():</span>

    <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start eval...................&quot;</span><span class="p">)</span>
    <span class="n">xtest</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">circle</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">test_accuracy</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">x_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">xtest</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">xtest</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))))</span>
    <span class="n">predicted_test</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">test_data</span><span class="p">,</span> <span class="n">test_label</span> <span class="ow">in</span> <span class="n">get_minibatch_data</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>

        <span class="n">test_data</span><span class="p">,</span> <span class="n">test_label</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">(</span><span class="n">test_data</span><span class="p">),</span><span class="n">QTensor</span><span class="p">(</span><span class="n">test_label</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
        <span class="n">test_accuracy</span> <span class="o">+=</span> <span class="n">get_score</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">test_label</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="n">batch_size</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;test_accuracy:</span><span class="si">{</span><span class="n">test_accuracy</span><span class="o">/</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>​  训练测试结果图</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="n">training</span><span class="o">...........</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.6145833333333334</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.020432369535168013</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.6854166666666667</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.01872217481335004</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.8104166666666667</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.016634768371780715</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.7479166666666667</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.016975031544764835</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.7875</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.016502128106852372</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.8083333333333333</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.0163204787299037</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.8083333333333333</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.01634311651190122</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.016330583145221074</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.8125</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.01629052646458149</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.8083333333333333</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.016270687493185203</span>

<span class="n">start</span> <span class="nb">eval</span><span class="o">...................</span>
<span class="n">test_accuracy</span><span class="p">:</span><span class="mf">0.826</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/图附2.3.2.png"><img alt="../_images/图附2.3.2.png" class="align-center" src="../_images/图附2.3.2.png" style="width: 750px;" /></a>
<p class="centered">
<strong>图附2.3.2 训练测试结果图</strong></p></section>
</section>
<section id="qurator">
<h1>2.4 Qurator<a class="headerlink" href="#qurator" title="Permalink to this heading">¶</a></h1>
<p>  一种基于VS Code的量子程序开发工具。</p>
<p>   qurator-vscode 是本源量子推出的一款可以开发量子程序的 VS Code 插件。其支持 QRunes2 语言量子程序开发，并支持 Python 和 C++ 语言作为经典宿主语言。</p>
<p>  在 qurator-vscode 中，量子程序的开发主要分为编写和运行两个部分。</p>
<p>  ·编写程序：插件支持模块化编程，在不同的模块实现不同的功能，其中量子程序的编写主要在 qcodes 模块中；</p>
<p>  ·程序运行：即是收集结果的过程，插件支持图表化数据展示，将运行结果更加清晰的展现在您的面前。</p>
<section id="id2">
<h2>2.4.1 设计思想<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h2>
<p>​  考虑到目前量子程序的开发离不开经典宿主语言的辅助，qurator-vscode 插件设计时考虑到一下几点：</p>
<p>    （1）模块编程：</p>
<p>​  qurator-vscode 插件支持模块编程，将整体程序分为三个模块：settings、qcodes 和 script 模块。在不同的模块完成不同的功能。 在 settings 模块中，您可以进行宿主语言类型、编译还是运行等设置；在 qcodes 模块中， 您可以编写 QRunes2 语言程序； 在 script 模块中，您可以编写相应的宿主语言程序。</p>
<p>    （2）切换简单：</p>
<p>  ​qurator-vscode 插件目前支持两种宿主语言，分别为 Python 和 C++。您可以在两种宿主语言之间自由的切换，您只需要在 settings 模块中设置 language 的 类型，就可以在 script 模块中编写对应宿主语言的代码。插件会自动识别您所选择的宿主语言，并在 script 模块中提供相应的辅助功能。</p>
<p>    （3）图形展示：</p>
<p>​  qurator-vscode 插件提供图形化的结果展示，程序运行后会展示 json 格式的运行结果，您可以点击运行结果，会生成相应的柱状图，方便您对运行结果的分析。</p>
</section>
<section id="id3">
<h2>2.4.2 准备工作<a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h2>
<p>​  使用 qurator-vscode 插件之前需要做一些准备工作，以确保量子程序能够正确的运行。</p>
<p>​  需要依赖的运行环境有：</p>
<p>​  ​  ​  ​·Python (版本 3.6.4 - 3.6.8)</p>
<p>​  ​  ​  ​·Pip (版本 10.1 及以上)</p>
<p>​  ​  ​  ·Microsoft Visual C++ Redistributable (Windows)</p>
<p>​  ​  ​  ·MinGw-w64 (Windows 64位版本)</p>
<p>​  其中，pip 负责下载宿主语言为 Python 时程序运行所依赖的包。Microsoft Visual C++ Redistributable 和 MinGw-w64 是宿主语言为 C++ 时程序运行所依赖的包。</p>
<p>​    （1）安装插件</p>
<p>​  首先需要您安装 [VS Code](<a class="reference external" href="https://code.visualstudio.com/">https://code.visualstudio.com/</a>) ，然后打开 VS Code 安装 qurator-vscode 插件： 使用 Ctrl + Shift + X 快捷键打开插件页面，或者您可以在最左侧栏找到 Extensions 点击进入，然后输入 qurator-vscode 来搜索插件，点击 Install 按钮进行插件的安装。</p>
<a class="reference internal image-reference" href="../_images/图附2.4.1.jpg"><img alt="../_images/图附2.4.1.jpg" class="align-center" src="../_images/图附2.4.1.jpg" style="width: 500px;" /></a>
<p class="centered">
<strong>图附2.4.1 插件安装</strong></p><p>​  ​  ​（2）检测运行环境</p>
<p>​​  插件安装好之后，您可以创建以 .qrunes 结尾的文件，此时插件会自动检测是否存在程序运行所依赖的环境。您也可以自己检测程序运行环境，使用 Ctrl + Shift + P 快捷键打开 VS Code 命令行， 输入 qurator-vscode 时您可以看到 qurator-vscode: Check Qurator VSCode Extension dependencies 选择项，点击此项就可以进行运行环境的检测。</p>
<a class="reference internal image-reference" href="../_images/图附2.4.2.jpg"><img alt="../_images/图附2.4.2.jpg" class="align-center" src="../_images/图附2.4.2.jpg" style="width: 500px;" /></a>
<p class="centered">
<strong>图附2.4.2 运行环境检测</strong></p><p>​​  检测到运行时所需环境，会在右下角展示软件及版本号：</p>
<a class="reference internal image-reference" href="../_images/图附2.4.3.jpg"><img alt="../_images/图附2.4.3.jpg" class="align-center" src="../_images/图附2.4.3.jpg" style="width: 500px;" /></a>
<p class="centered">
<strong>图附2.3.3 软件及版本号</strong></p></section>
<section id="id4">
<h2>2.4.3 快速入门<a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h2>
<p>​​  在做好准备工作之后，下面就可以编写属于您自己的量子程序了。</p>
<p>​​  ​​  （1）项目文件夹中启动 VS Code</p>
<p>​​​  在命令提示符或终端上，创建一个名为 “test” 的空文件夹，切换到该文件夹，然后输入命令 code . 在该文件夹中打开 VS Code：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span><span class="n">mkdir</span> <span class="n">test</span>
<span class="mf">2.</span><span class="n">cd</span> <span class="n">test</span>
<span class="mf">3.</span><span class="n">code</span> <span class="o">.</span>
</pre></div>
</div>
<p>​​​  或者，您可以点击运行 VS Code，然后点击 “File” &gt; “Open File…” 打开项目文件夹。在文件夹中启动 VS Code，该文件夹将成为您的“工作区”。您可以在 .vscode/settings.json 文件中更改工作区的相关设置。</p>
<p>​​​  ​​​  （2）创建一个 qrunes 文件</p>
<p>​​​  在文件资源管理器工具栏中，单击 “test” 文件夹上的 “New File” 按钮，并命名该文件为 qurator_test.qrunes。</p>
<a class="reference internal image-reference" href="../_images/图附2.4.4.jpg"><img alt="../_images/图附2.4.4.jpg" class="align-center" src="../_images/图附2.4.4.jpg" style="width: 500px;" /></a>
<p class="centered">
<strong>图附2.4.4 创建 qrunes 文件</strong></p><p>​​​  ​​​  （3）编写量子程序</p>
<p>​​​  qrunes 文件创建完成之后，便可以编写量子程序了。整个量子程序分为三个部分：settings、qcodes 和 script 三个模块。</p>
<p>​​​  其中，settings 模块中可以设置宿主语言，编译还是运行；qcodes 模块中可以编写 QRunes2 量子语言代码； script 模块中可以编写宿主语言代码，目前支持 Python 和 C++ 两种宿主语言。</p>
<a class="reference internal image-reference" href="../_images/图附2.4.5.jpg"><img alt="../_images/图附2.4.5.jpg" class="align-center" src="../_images/图附2.4.5.jpg" style="width: 500px;" /></a>
<p class="centered">
<strong>图附2.4.5 编写量子程序</strong></p><p>​​​  ​​​  （4）编译运行</p>
<p>​​​  点击右上方 Run this QRunes 运行程序，或者使用命令提示符 qurator-vscode: Run this QRunes 来运行程序(快捷键 F5)：</p>
<a class="reference internal image-reference" href="../_images/图附2.4.6.1.jpg"><img alt="../_images/图附2.4.6.1.jpg" class="align-center" src="../_images/图附2.4.6.1.jpg" style="width: 500px;" /></a>
<a class="reference internal image-reference" href="../_images/图附2.4.6.2.jpg"><img alt="../_images/图附2.4.6.2.jpg" class="align-center" src="../_images/图附2.4.6.2.jpg" style="width: 500px;" /></a>
<p class="centered">
<strong>图附2.4.6 编译运行</strong></p><p>​​​  上述示例程序的运行结果如图附2.3.7：</p>
<a class="reference internal image-reference" href="../_images/图附2.4.7.jpg"><img alt="../_images/图附2.4.7.jpg" class="align-center" src="../_images/图附2.4.7.jpg" style="width: 500px;" /></a>
<p class="centered">
<strong>图附2.4.7 运行结果</strong></p></section>
<section id="id5">
<h2>2.4.4 功能介绍<a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h2>
<p>​​​
​​​  相信在快速入门步骤之后，您已大体了解插件的整体功能，下面将介绍您在编辑量子程序过程中插件提供的辅助功能：</p>
<p>​​​  ​​​  （1）自动补全</p>
<p>​​​  对于 QRunes2 语言内设的关键字可以智能提示，根据输入的字符列为您提供当前上下文中适用的最相关符号列表并提示其功能， 以便您可以更快地选择。</p>
<a class="reference internal image-reference" href="../_images/图附2.4.8.jpg"><img alt="../_images/图附2.4.8.jpg" class="align-center" src="../_images/图附2.4.8.jpg" style="width: 500px;" /></a>
<p class="centered">
<strong>图附2.4.8 自动补全</strong></p><p>​​​​  ​​​  （2）验证提示</p>
<p>​​​​  对于输入进行验证并提示。每当插件检测到您编写的代码发生语法错误时，编辑器中会显示红色波浪线， 鼠标放上去可看到一系列错误信息，您可以准确定位错误发生的位置。</p>
<a class="reference internal image-reference" href="../_images/图附2.4.9.jpg"><img alt="../_images/图附2.4.9.jpg" class="align-center" src="../_images/图附2.4.9.jpg" style="width: 500px;" /></a>
<p class="centered">
<strong>图附2.4.9 验证提示</strong></p><p>​​​​  ​​​​  （3）高亮展示</p>
<p>​​​​​​​  不同的模块有不同的颜色划分，您可以清晰地编写每一个模块的代码，一目了然，快速开发。</p>
<a class="reference internal image-reference" href="../_images/图附2.4.10.jpg"><img alt="../_images/图附2.4.10.jpg" class="align-center" src="../_images/图附2.4.10.jpg" style="width: 500px;" /></a>
<p class="centered">
<strong>图附2.4.10 高亮展示</strong></p><p>​​​​  ​​​​  （4）悬浮提示</p>
<p>​​​​  QRunes2 语言中的方法、变量都有详细的解释及用法。每当您编写 QRunes2 语言内设关键字时， 将鼠标放在该关键字上，编辑器将会显示该关键字的功能信息。</p>
<a class="reference internal image-reference" href="../_images/图附2.4.11.jpg"><img alt="../_images/图附2.4.11.jpg" class="align-center" src="../_images/图附2.4.11.jpg" style="width: 500px;" /></a>
<p class="centered">
<strong>图附2.4.11 悬浮提示</strong></p><p>​​​​  ​​​​  （5）智能片段</p>
<p>​​​​  智能片段功能是指用户输入简短的触发指令而生成完整的代码片段，在本插件中内置了自定义代码片段， 可帮助您整理一些重复性代码，提高开发效率。</p>
<a class="reference internal image-reference" href="../_images/图附2.4.12.jpg"><img alt="../_images/图附2.4.12.jpg" class="align-center" src="../_images/图附2.4.12.jpg" style="width: 500px;" /></a>
<p class="centered">
<strong>图附2.4.12 智能片段</strong></p><p>​​​​  ​​​​  （6）语言切换</p>
<p>​​​​  目前 QRunes2 语言可以支持 Python 及 C++ 宿主语言，您可以在 settings 模块的 language 关键字来设置 所需支持的语言类型，就可以在script模块编写相应语言的代码。</p>
<a class="reference internal image-reference" href="../_images/图附2.4.13.jpg"><img alt="../_images/图附2.4.13.jpg" class="align-center" src="../_images/图附2.4.13.jpg" style="width: 500px;" /></a>
<p class="centered">
<strong>图附2.4.13 语言切换</strong></p><p>​​​​  ​​​​  （7）编译运行</p>
<p>​​​​  运行 QRunes2 语言代码，编译器会根据设定的语言去编译该代码，从而实现不同的语言编写生成相同的结构。</p>
<a class="reference internal image-reference" href="../_images/图附2.4.14.jpg"><img alt="../_images/图附2.4.14.jpg" class="align-center" src="../_images/图附2.4.14.jpg" style="width: 500px;" /></a>
<p class="centered">
<strong>图附2.4.14 编译运行</strong></p></section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="%E9%99%84%E5%BD%951%E9%87%8F%E5%AD%90%E8%AE%A1%E7%AE%97%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%805.html" class="btn btn-neutral float-left" title="1.6 矩阵的函数" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="%E9%99%84%E5%BD%953%E9%87%8F%E5%AD%90%E5%8C%96%E5%AD%A6%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8.html" class="btn btn-neutral float-right" title="3.1 ChemiQ化学软件的安装" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Original Quantum.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>